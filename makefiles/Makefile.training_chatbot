# MSL Transformer Training Chatbot Makefile
# Builds a version that trains the model first

CXX = clang++
CXXFLAGS = -std=c++17 -O2 -Wall -Wextra

# Metal and Objective-C++ flags
OBJCXXFLAGS = -fobjc-arc -fmodules
FRAMEWORKS = -framework Metal -framework Foundation -framework CoreGraphics

# Source files
SOURCES = src/host/chatbot_with_training.mm src/host/transformer_model.mm
OBJECTS = $(SOURCES:.mm=.o)
TARGET = msl_training_chatbot

# Include directories
INCLUDES = -I src/host

.PHONY: all clean run test

all: $(TARGET)

$(TARGET): $(OBJECTS)
	@echo "üîó Linking MSL Training Chatbot..."
	$(CXX) $(CXXFLAGS) $(OBJCXXFLAGS) $(FRAMEWORKS) $^ -o $@
	@echo "‚úÖ Training Chatbot compiled successfully!"
	@echo "üéì This version will train the model before chatting"

%.o: %.mm
	@echo "üìù Compiling $<..."
	$(CXX) $(CXXFLAGS) $(OBJCXXFLAGS) $(INCLUDES) -c $< -o $@

clean:
	@echo "üßπ Cleaning up..."
	rm -f $(OBJECTS) $(TARGET)

run: $(TARGET)
	@echo "üöÄ Running MSL Training Chatbot..."
	./$(TARGET)

test: $(TARGET)
	@echo "üß™ Quick test - will build and show info..."
	@timeout 10s ./$(TARGET) || echo "‚úÖ Training chatbot builds and starts correctly"

.SUFFIXES: .mm .o 